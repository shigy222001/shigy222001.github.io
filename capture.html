<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <link rel="manifest" href="manifest.json">
  <title>Push Notification</title>
</head>
<body>
<script>
var serviceWorker = navigator.serviceWorker;

messaging.requestPermission();

serviceWorker.register('serviceworker.js').then(() => {
  return serviceWorker.ready;
}).then(regist => {
  messaging.useServiceWorker(regist);
  messaging.requestPermission().then(() => {
    messaging.getToken().then(token => {
      console.log(token);
    });
  });
});
</script>

<!-- 撮影 -->
<video id="player" controls autoplay />
<button id="capture">撮影</button>
<canvas id="snapshot" width="320" height="240" />
<script>
  var player = document.getElementById('player');
  var snapshotCanvas = document.getElementById('snapshot');
  var captureButton = document.getElementById('capture');
  var videoTracks;

  var handleSuccess = function(stream) {
    // Attach the video stream to the video element and autoplay.
    player.srcObject = stream;
    videoTracks = stream.getVideoTracks();
  };

  captureButton.addEventListener('click', function() {
    var context = snapshot.getContext('2d');
    // Draw the video frame to the canvas.
    context.drawImage(player, 0, 0, snapshotCanvas.width,
        snapshotCanvas.height);

    // Stop all video streams.
    videoTracks.forEach(function(track) }track.stop()});
  });

  navigator.mediaDevices.getUserMedia({video: true})
      .then(handleSuccess);
</script>
<input type="button" value="撮影" onclick="OnCaptureButtonClick();"/>
<br/>
</body>
</html>
